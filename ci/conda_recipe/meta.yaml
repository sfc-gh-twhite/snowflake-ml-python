# TODO(SNOW-728020): Make this file a template so that it can read ground truths
# (dependencies, version number) from a common place. We also need to define that
# common place, as currently it's a BUILD rule.
# See https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html#templating-with-jinja
{% set version_match = load_file_regex(load_file='snowflake/ml/version.bzl', regex_pattern='VERSION = "(\d\.\d\.\d*)"\s.*') %}

package:
  name: snowflake-ml-python
  version: {{ version_match.group(1) }}

source:
  path: ../../

build:
  noarch: python

requirements:
  build:
    - python
    - bazel >=6.0.0
  run:
    - python
    - absl-py>=0.15,<2
    - anyio>=3.5.0,<4
    - cloudpickle
    - fsspec>=2022.11,<=2023.1
    - numpy>=1.23,<2
    - packaging>=23.0,<24
    - pandas>=1.0.0,<2  # Limit since 2.x is not available in Snowflake Anaconda Channel yet.
    - pyyaml>=6.0,<7
    - scikit-learn>=1.2.1,<2
    - scipy>=1.9,<2
    - snowflake-connector-python
    - snowflake-snowpark-python>=1.4.0,<=2
    - sqlparse>=0.4,<1
    - typing-extensions>=4.1.0,<5
    - xgboost>=1.7.3,<2

    # conda-libmamba-solver is conda-specific requirement, and should not appear in wheel's dependency.
    - conda-libmamba-solver>=23.1.0,<24
  run_constrained:
    # Any dependencies required by extra should be specified here so that conda could consider the constraints when
    # installing them simultaneously. This part should sync with the extra_requirements in snowml_wheel in
    # snowflake/ml/BUILD.bazel file.
    - tensorflow>=2.9,<3
    - torchdata>=0.4,<1
    - lightgbm==3.3.5

about:
  home: https://github.com/snowflakedb/snowflake-ml-python
  license: Apache-2.0
  license_family: Apache
  license_file: ../../LICENSE.txt
  summary: Snowflake ML Library
  description: |
    Snowflake ML client Library is used for interacting with Snowflake to build machine learning solutions.
    Functionalities include feature engineering, modeling, model management, deployment, etc
  dev_url: https://github.com/snowflakedb/snowflake-ml-python
  doc_url: https://github.com/snowflakedb/snowflake-ml-python/blob/main/README.md
